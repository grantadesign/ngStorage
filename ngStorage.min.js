/*! ngstorage 0.3.7 | Copyright (c) 2015 Gias Kay Lee | MIT License */!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["angular"],b):"object"==typeof exports?module.exports=b(require("angular")):b(a.angular)}(this,function(a){"use strict";function b(b){return function(){var c="ngStorage-",d="ngStorageUpdated-";this.setKeyPrefix=function(a){if("string"!=typeof a)throw new TypeError("[ngStorage] - "+b+"Provider.setKeyPrefix() expects a String.");c=a};var e=a.toJson,f=a.fromJson;this.setSerializer=function(a){if("function"!=typeof a)throw new TypeError("[ngStorage] - "+b+"Provider.setSerializer expects a function.");e=a},this.setDeserializer=function(a){if("function"!=typeof a)throw new TypeError("[ngStorage] - "+b+"Provider.setDeserializer expects a function.");f=s},this.$get=["$rootScope","$window","$log","$timeout",function(g,h,i,j){function k(a){var b;try{b=h[a]}catch(c){b=!1}if(b&&"localStorage"===a){var d="__"+Math.round(1e7*Math.random());try{localStorage.setItem(d,d),localStorage.removeItem(d)}catch(c){b=!1}}return b}var l,m,n=k(b)||(i.warn("This browser does not support Web Storage!"),{setItem:a.noop,getItem:a.noop}),o={$default:function(b){for(var c in b)a.isDefined(o[c])||(o[c]=b[c]);return o.$sync(),o},$reset:function(a){for(var b in o)"$"===b[0]||delete o[b]&&n.removeItem(c+b);return o.$default(a)},$sync:function(){for(var a,b=0,d=n.length;d>b;b++)(a=n.key(b))&&c===a.slice(0,10)&&(o[a.slice(10)]=f(n.getItem(a)))}};o.$sync(),l=a.copy(o);var p=function(a){n.setItem(d+a,(new Date).toString()),n.removeItem(d+a)};return g.$watch(function(){var b;m||(m=j(function(){if(m=null,!a.equals(o,l)){b=a.copy(l),a.forEach(o,function(d,f){if(a.isDefined(d)&&"$"!==f[0]){var g=e(d),h=c+f;a.equals(g,n.getItem(h))||(n.setItem(h,g),p(f))}delete b[f]});for(var d in b)n.removeItem(c+d),p(d);l=a.copy(o)}},100,!1))}),h.addEventListener&&h.addEventListener("storage",function(b){if(!(h.document&&h.document.hasFocus&&h.document.hasFocus())&&d===b.key.slice(0,d.length)){if(!b.newValue)return;var c=b.key.slice(d.length);h.setTimeout(function(){var b=n.getItem("ngStorage-"+c);b?o[c]=f(b):delete o[c],l=a.copy(o),g.$apply(),g.$emit(d+c)})}}),o}]}}return a=a||window.angular,a.module("ngStorage",[]).provider("$localStorage",b("localStorage")).provider("$sessionStorage",b("sessionStorage"))});